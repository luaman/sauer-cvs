<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<title>Sauerbraten Models</title>
<link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>

<h1>Sauerbraten Models</h1>

<div class="contents">
<ul class="contents">
<li>
<a href="#md2_format"><b>MD2 Format</b></a>
<ul class="contents2">
<li>
<a href="#md2anim"><tt>md2anim</tt></a>
</li>
</ul>
</li>
<li>
<a href="#md3_format"><b>MD3 Format</b></a>
<ul class="contents2">
<li>
<a href="#without_configuration">Without Configuration</a>
</li>
<li>
<a href="#with_configuration">With Configuration</a>
<ul class="contents3">
<li>
<a href="#md3load"><tt>md3load</tt></a>
</li>
<li>
<a href="#md3pitch"><tt>md3pitch</tt></a>
</li>
<li>
<a href="#md3skin"><tt>md3skin</tt></a>
</li>
<li>
<a href="#md3anim"><tt>md3anim</tt></a>
</li>
<li>
<a href="#md3link"><tt>md3link</tt></a>
</li>
</ul>
</li>
<li>
<a href="#sample_configuration">Sample Configuration</a>
</li>
</ul>
</li>
<li>
<a href="#common_commands"><b>Common Commands</b></a>
<ul class="contents2">
<li>
<a href="#mdlcollide"><tt>mdlcollide</tt></a>
</li>
<li>
<a href="#mdlbb"><tt>mdlbb</tt></a>
</li>
<li>
<a href="#mdlcullface"><tt>mdlcullface</tt></a>
</li>
<li>
<a href="#mdlspec"><tt>mdlspec</tt></a>
</li>
<li>
<a href="#mdlalphatest"><tt>mdlalphatest</tt></a>
</li>
<li>
<a href="#mdlalphablend"><tt>mdlalphablend</tt></a>
</li>
<li>
<a href="#mdlglow"><tt>mdlglow</tt></a>
</li>
<li>
<a href="#mdlshader"><tt>mdlshader</tt></a>
</li>
<li>
<a href="#mdlambient"><tt>mdlambient</tt></a>
</li>
<li>
<a href="#mdlscale"><tt>mdlscale</tt></a>
</li>
<li>
<a href="#mdltrans"><tt>mdltrans</tt></a>
</li>
<li>
<a href="#mdlenvmap"><tt>mdlenvmap</tt></a>
</li>
<li>
<a href="#mdlshadow"><tt>mdlshadow</tt></a>
</li>
</ul>
</li>
</ul>
</div>

<h2 id="md2_format">MD2 Format</h2>

<p>
MD2 files must be located in a directory in <i>packages/models/</i>, you must provide a skin
(either <i>skin.jpg</i> or <i>skin.png</i>) and the md2 itself (<i>tris.md2</i>).
Optionally you may provide a <i>masks.jpg</i> that holds a specmap in the R channel, a glowmap
in the G channel, and a chrome map in the B channel. The engine will apply it automatically.
</p>

<p>
If either of these files is not found, Sauerbraten will search the parent directory for them.
For example, if for the <i>flags/red</i> model, the tris.md2 is not found in
<i>packages/models/flags/red/</i>, then it will look for tris.md2 in <i>packages/models/flags/</i>.
This allows the sharing of skins and geometry.
</p>

<p>
Sauerbraten expects the md2 to use Quake-compatible scale and animations, unless you configure
the model otherwise.
</p>

<p>
You may also supply a config file (<i>md2.cfg</i>) in your model directory, which allows you to
customize the model's animations. The following commands may be used in an <i>md2.cfg</i>:
</p>

<pre id="md2anim">md2anim N F M [S [P]]</pre>
<p>
N is the name of the animation to define. Any of the following names may be used:
</p>
<ul>
	<li>dying</li>
	<li>dead</li>
	<li>pain</li>
	<li>idle</li>
	<li>forward</li>
	<li>backward</li>
	<li>left</li>
	<li>right</li>
	<li>punch</li>
	<li>shoot</li>
	<li>jump</li>
    <li>sink</li>
	<li>swim</li>
	<li>edit</li>
	<li>lag</li>
    <li>taunt</li>
    <li>win</li>
    <li>lose</li>
	<li>gun shoot</li>
	<li>gun idle</li>
	<li>mapmodel</li>
	<li>trigger</li>
</ul>

<p>
F is the frame number the animation starts at. M is the number of frames in the
animation. S is the optional frames per second at which to run the anim. If none is specified,
10 FPS is the default. P specifies an optional priority for the animation (defaults to P=0).
</p>

<p>
For example, defining a "pain" animation starting at frame 50 with 6 frames and running at 30 frames per
second would like like: <i>md2anim "pain" 50 6 30</i>
</p>


<h2 id="md3_format">MD3 Format</h2>
<p>
MD3 file can be used for Sauerbraten in one of two ways.
</p>

<h3 id="without_configuration">Without Configuration</h3>

<p>
Go this way if your md3 has no animations (static) and takes only one texture, they must be
located in a directory in <i>packages/models/</i>, and provide a skin (either <i>skin.jpg</i>
or <i>skin.png</i>) and the md3 itself (<i>tris.md3</i>). Optionally you may provide a
<i>masks.jpg</i> that holds a specmap in the R channel, a glowmap in the G channel, and a
chrome map in the B channel. The engine will apply it automatically.
</p>

<p>
If either of these files is not found, Sauerbraten will search the parent directory for them.
For example, if for the <i>flags/red model</i>, the <i>tris.md3</i> is not found in
<i>packages/models/flags/red/</i>, then it will look for <i>tris.md3</i> in
<i>packages/models/flags/</i>. This allows the sharing of skins and geometry.
</p>

<h3 id="with_configuration">With Configuration</h3>

<p>
MD3 files with animations multiple skins, or if you want to make use of other configuration
possibilities, need to be set up this way. You must place a <i>md3.cfg</i> in a directory in
<i>packages/models/</i>. This file specifies which models should be loaded, linked, etc. The
following commands may be used in the <i>md3.cfg</i>:
</p>

<pre id="md3load">md3load P</pre>
<p>
This command loads the first part of your model. As an example, this could be the <i>head.md3</i>
of a playermodel. P is the path to the md3 file to load, its recursive to the location of the
<i>md3.cfg</i>.
</p>

<pre id="md3pitch">md3pitch S O M N</pre>
<p>
This command controls how a model responds to the model's pitch. The pitch (in degrees) is scaled
by S, offset by O, and then clamped to the range M..N, i.e. clamp(pitch*S + O, M, N). By default, 
all model parts have S=1, O=0, M=-360, and N=360, such that the model part will pitch one-to-one.
</p>

<pre id="md3skin">md3skin H S M [E [F]]</pre>
<p>
This loads a texture and assigns it to a mesh of the last loaded model (md3load). H is the name
of the mesh you want to assign the texture to. S is the path to the texture, its recursive
to the location of the <i>md3.cfg</i>. The optional M sets a texture for spec (red channel)/glow
(green channel) maps as above. If E is non-zero, then the blue channel of the masks is
interpreted as a chrome map. E (maximum envmap intensity) and F (minimum envmap intensity, default: 0) are floating point 
values in the range of 0 to 1, and specify the range in which the envmapping intensity will vary based on a viewing angle
(a Fresnel term that is maximal at glancing angles, minimal when viewed dead-on). The intensity, 
after scaled into this range, is then multiplied by the chrome map.
</p>

<pre id="md3anim">md3anim A F N [S [P]]</pre>
<p>
This assigns a new animation to the last loaded model (md3load). A is the name of the animation
to define. Any of the following names may be used:
</p>
<ul>
	<li>dying</li>
	<li>dead</li>
	<li>pain</li>
	<li>idle</li>
	<li>forward</li>
	<li>backward</li>
	<li>left</li>
	<li>right</li>
	<li>punch</li>
	<li>shoot</li>
	<li>jump</li>
    <li>sink</li>
	<li>swim</li>
	<li>edit</li>
	<li>lag</li>
    <li>taunt</li>
    <li>win</li>
    <li>lose</li>
	<li>gun shoot</li>
	<li>gun idle</li>
	<li>mapmodel</li>
	<li>trigger</li>
</ul>

<p>
F is the frame number the animation starts at. N is the number of frames in the animation.
S is frames per second at which to run the anim. If none is specified or S=0, 10 FPS is the default.
P specifies an optional priority for the animation (defaults to P=0).
</p>

<p>
A character model will have up to 2 animations simultaneously playing - a primary animation
and a secondary animation. If a character model defines the primary animation, it will be used,
otherwise the secondary will be used if it is available. Primary animations are:
</p>
<ul>
	<li>dying</li>
	<li>dead</li>
	<li>pain</li>
	<li>punch</li>
	<li>shoot</li>
	<li>edit</li>
	<li>lag</li>
    <li>taunt</li>
    <li>win</li>
    <li>lose</li>
</ul>

<p>
Secondary animations are:
</p>
<ul>
	<li>idle</li>
	<li>forward</li>
	<li>backward</li>
	<li>left</li>
	<li>right</li>
	<li>punch</li>
	<li>shoot</li>
	<li>jump</li>
    <li>sink</li>
	<li>swim</li>
</ul>

<p>
This allows, for example, a torso part to "shoot" (a primary animation) while a leg part
simultaneously runs "forward" (a secondary animation). In the event that a secondary animation
other than "idle" is playing and there is no primary animation, then the secondary animation
will behave as if it were primary, and the secondary animation will effectively be "idle".
This allows parts that would not normally participate in a certain animation to do so in the
"idle" case, or otherwise simply be "idle" if this is not desired. However, if you want to override
which animation is primary for a specific part, you can set an explicit priority for that animation,
and the animation with the highest priority is chosen, regardless of which is primary and 
which is secondary. So, for example, you could give an animation a -1 priority so that all animations
with the default 0 priority are chosen first, or you could give an animation a 1 or greater priority
so that it is always chosen before animations with the default 0 priority.
</p>

<p>
For example, to define a "punch" animation starting at frame 131 with 6 frames and running at
15 frames per second: <i>md3anim "punch" 131 6 15</i>
</p>

<pre id="md3link">md3link P C T</pre>
<p>
This links two models together. Every model you load with md3load has an ID. The first model
you load has the ID 0, the second has the ID 1, and so on, those ID's are now used to identify
the models and link them together. P the ID of the parent model. C to ID of the
child model. T name of the tag that specifies at which vertex the models should be linked.
</p>

<p>
Hint: <i>Make sure you understand the difference between the parent and child model.
Rendering starts at model 0 (first loaded model) and then continues with model 0's children,
etc. Imagine a tree, model 0 is the root if it.</i>
</p>

<h3 id="sample_configuration">Sample Configuration</h3>
<pre>
md3load lower.md3 // model no. 0
md3skin l_lower ./default_l.png

md3anim dying           0   30  20
md3anim dead            30  1   25
md3anim "forward|backward|left|right|swim" 114 10  18
md3anim idle            164 30  30
md3anim "jump|lag|edit" 147	8	15

md3load upper.md3 // model no. 1
md3skin u_torso ./default.png

md3anim dying           0   30  20
md3anim dead            30  1   25
md3anim "lag|edit"      91  40  18
md3anim "punch|shoot"   131 6   15
md3anim idle            152 1   15
md3anim pain            152 1   15


md3load head.md3 // model no. 2
md3skin h_head ./default_h.png


md3link 0 1 tag_torso
md3link 1 2 tag_head

mdlspec 50
mdlscale 20         // 20 percent of the original size
mdltrans 0 0 -1.5   // lower the model a bit
</pre>

<h2 id="common_commands">Common Commands</h2>
<pre id="mdlcollide">mdlcollide N</pre>
<p>
If N is 0, collisions with the model are disabled (Default: 1).
</p>

<pre id="mdlbb">mdlbb R H [E]</pre>
<p>
Sets the model's bounding box to radius R and height H. If this is not set, or R and H are 0, 
a bounding box is automatically generated from the model's geometry. E is fraction of the
model's height to be used as the eyeheight (Default: 0.9).
</p>

<pre id="mdlcullface">mdlcullface N</pre>
<p>
If N is 0, backface culling is disabled for this model. Otherwise, backface culling is enabled
(Default: 1).
</p>

<pre id="mdlspec">mdlspec S</pre>
<p>
S is the specular intensity (not given or 0 gives the default of 100, good for metal/plastics
and anything shiny, use lower values like 50 for wood etc, -1 means off entirely).
</p>

<pre id="mdlalphatest">mdlalphatest T</pre>
<p>
Controls the cut-off threshold, T, at which alpha-channel skins will discard pixels where alpha is less than T.
T is a floating point value in the range of 0 to 1 (Default: 0.9).
</p>

<pre id="mdlalphablend">mdlalphablend B</pre>
<p>
Controls whether a model with an alpha-channel skin will alpha blend (Default: 1).
</p>

<pre id="mdlglow">mdlglow G</pre>
<p>
G is the glowmap scale (not given or 0 gives the default of 300, -1 means off entirely), such that 
the glow is G percent of the diffuse skin color.
</p>

<pre id="mdlshader">mdlshader S</pre>
<p>
S is the name of the shader to use for rendering the model (Default: "stdmodel").
</p>

<pre id="mdlambient">mdlambient A</pre>
<p>
A is the percent of the ambient light that should be used for shading. Not given or 0 gives the
default of 30%, -1 means no ambient.
</p>

<pre id="mdlscale">mdlscale S</pre>
<p>
Scale the model's size to be S percent of its default size.
</p>

<pre id="mdltrans">mdltrans X Y Z</pre>
<p>
Translate the model's center by (X, Y, Z), where X/Y/Z are in model units (may use floating
point).
</p>

<pre id="mdlenvmap">mdlenvmap E F [P]</pre>
<p>
Sets the environment map used for the model, where P is a pathname in the same syntax as the
"loadsky" command. If this is not specified, the model will use the closest "envmap" entity,
or skybox, if none is available. If E is non-zero, then the blue channel of the masks is
interpreted as a chrome map. E (maximum envmap intensity) and F (minimum envmap intensity, default: 0) are floating point
values in the range of 0 to 1, and specify the range in which the envmapping intensity will vary based on a viewing angle
(a Fresnel term that is maximal at glancing angles, minimal when viewed dead-on). The intensity,
after scaled into this range, is then multiplied by the chrome map.
</p>

<pre id="mdlshadow">mdlshadow B</pre>
<p>
Controls whether a mapmodel will cast shadows (Default: 1).
</p>

</body>
</html>
